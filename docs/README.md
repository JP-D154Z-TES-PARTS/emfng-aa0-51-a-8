# baseフォルダ解析ドキュメント

このディレクトリには、baseフォルダ内のソースコードと仕様書の対応関係分析結果が格納されています。

## ドキュメント一覧

### 1. [base_spec_code_correspondence.md](./base_spec_code_correspondence.md)
**仕様書とコードの対応関係マッピングドキュメント**

- 仕様書（D0emfng-aa0-50-a.doc）とemfng_l_mat.cの対応関係
- 主要機能のマッピング
- データ構造とインターフェースの解説
- 処理フローの詳細
- 今後の解析推奨事項

### 2. [code_structure_analysis.md](./code_structure_analysis.md)
**コード構造解析レポート**

- コードメトリクスと統計情報
- アーキテクチャ概要
- 関数カタログ（40以上の関数）
- データ構造の詳細分析
- 制御フローの可視化
- 条件コンパイル解析
- パフォーマンス評価
- コード品質とセキュリティ評価

## 分析概要

### 対象ファイル
- **ソースコード**: `base/emfng_l_mat.c` (約4,396行)
- **仕様書**: `base/emfng-aa0-50-a/D0emfng-aa0-50-a.doc` (33ページ、7,856語)
- **補助資料**: 
  - `base/emfng-aa0-50-a/document/ロジック変更シート_ver9.06_emfng-aa0.xlsx`
  - `base/emfng-aa0-50-a/document/参照元チェックシート_ver2.07_emfng-aa0-50-a.xlsx`

### 主要な発見事項

#### 1. モジュール目的
emfng_l_mat.cは、自動車エンジンの**触媒劣化故障診断部**を実装するモジュールです。

#### 2. 対応規格
- OBD (On-Board Diagnostics)
- OBD2
- 欧州OBD (EOBD)
- 米国法規対応

#### 3. 主要機能
- OT触媒（酸化触媒）劣化診断
- EM触媒（エミッション制御触媒）劣化診断
- 4気筒/6気筒エンジン対応
- MODE06診断データ出力
- バックアップRAMによるデータ永続化

#### 4. コード品質
- 総合評価: B+
- 詳細なコメントとドキュメント化
- 条件コンパイルによる柔軟な機種対応
- 長期運用実績を反映した堅牢な設計

## 推奨される次のステップ

### 即座に実行可能なアクション

1. **仕様書の詳細読解**
   - D0emfng-aa0-50-a.docをテキスト抽出して完全解析
   - 仕様書の各セクションとコードの完全なマッピング

2. **Excelシートの活用**
   - ロジック変更シートによる変更履歴の追跡
   - 参照元チェックシートによる依存関係の検証

3. **他ソースファイルとの関連分析**
   - emfng_4_c_mat.c (4気筒専用処理)
   - emfng_6_c_mat.c (6気筒専用処理)
   - emfng.h (ヘッダファイル)

### 詳細分析が必要な領域

1. **MODE06データの完全理解**
   - 計算方法の詳細
   - テストデータの意味
   - 診断ツールとの連携

2. **バックアップRAMの動作メカニズム**
   - データ整合性保証
   - 電源断時の動作
   - 初期化シーケンス

3. **条件コンパイルの全パターン検証**
   - 各スイッチ組み合わせでのコンパイル確認
   - 機能の有効/無効化の影響範囲

## 使用方法

### 仕様理解のために
1. まず `base_spec_code_correspondence.md` を読んで全体像を把握
2. 次に `code_structure_analysis.md` で詳細構造を理解
3. 実際のソースコードと照らし合わせながら確認

### コード修正のために
1. `code_structure_analysis.md` の関数カタログで該当関数を特定
2. `base_spec_code_correspondence.md` で仕様との対応を確認
3. 条件コンパイルスイッチの影響範囲を確認してから修正

### レビューのために
1. 両ドキュメントの「コード品質」「保守性評価」セクションを参照
2. 推奨改善事項に基づいてレビュー
3. MISRA-C準拠度を考慮

## 制限事項と注意点

### ドキュメント作成時の制約
1. **仕様書未読取**
   - D0emfng-aa0-50-a.docはバイナリ形式でテキスト抽出未実施
   - コード解析のみに基づく推定マッピング

2. **動的解析未実施**
   - 静的コード解析のみ
   - 実行時の動作確認は未実施

3. **テスト実行なし**
   - 単体テスト・結合テストは未実施
   - コードレビューのみ

### 推奨される検証方法
1. 仕様書を実際に読んでマッピングの正確性を検証
2. デバッガでの動作確認
3. 各種スイッチ組み合わせでのコンパイル確認
4. 実機またはシミュレータでの動作テスト

## 関連リソース

### 社内リファレンス
- コーディング規約: (該当するドキュメントへのリンク)
- MISRA-C準拠ガイドライン: (該当するドキュメントへのリンク)
- OBD規格書: (該当するドキュメントへのリンク)

### 外部リファレンス
- ISO 15765 (OBD on CAN)
- SAE J1979 (E/E Diagnostic Test Modes)
- ISO 14229 (UDS - Unified Diagnostic Services)

## 更新履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|----------|---------|--------|
| 2025-10-16 | 1.0 | 初版作成 | 自動解析ツール |

## フィードバック

このドキュメントに関する質問、改善提案、誤りの指摘などがある場合は、GitHubのIssueまたはPull Requestでお知らせください。

---

**注意**: このドキュメント群は、ソースコードの静的解析に基づいて自動生成されています。仕様書との完全な整合性確認には、実際の仕様書の読解が必要です。
